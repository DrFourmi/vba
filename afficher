Option Explicit
Option Base 1

Sub affichageComplet()

Call businessOverview
Call secondaryMarketTradeData
Call secondaryMarketTradeDataConso
Call primaryMarketTradeData
Call primaryMarketTradeDataConso
Call brokerDealers
Call brokerDealersEMOnly
Call countriesEMOnly
Call additionalInformation

End Sub

Sub businessOverview()

Workbooks(wbTemplate).Worksheets(wsTemplate1).Activate

Call tabNominal
Call tabMonthly
Call affichDate

Range("A1").Select

End Sub

Sub additionalInformation()

Workbooks(wbTemplate).Worksheets(wsTemplate9).Activate

Call afficherInstrumentCountry
Call afficherInstrumentSegment
Call afficherMaturityAndOutstandingAndNominal
Call afficherTradingVenues
Call afficherCapitalStructure

Range("A1").Select

End Sub

Sub afficherCapitalStructure()

Dim a As Long, b As Long, c As Long
Dim d As Integer, e As Integer
Dim trouve As Boolean
Dim col As String, colBroker As String
Dim row(3) As Long
Dim derniereLigne(3) As Long
row(1) = 11
col = "BK"
colBroker = "BJ"

For a = 1 To 3
    If a > 1 Then
        row(a) = derniereLigne(a - 1) + 6
    End If
    
    derniereLigne(a) = calculLastRow(col, row(a))
Next

For a = 1 To UBound(instrumentCapitalStructure)
    For e = 1 To 3
        trouve = False
        For c = row(e) To derniereLigne(e)
            If instrumentCapitalStructure(a).KStructure = Range(colBroker & c) Then
                trouve = True
                
                If e = 1 Then
                    If IsEmpty(instrumentCapitalStructure(a).amtBuyGov) = False Then
                        Range(col & c) = instrumentCapitalStructure(a).amtBuyGov
                        Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + instrumentCapitalStructure(a).amtBuyGov
                    End If
                    
                    If IsEmpty(instrumentCapitalStructure(a).amtSellGov) = False Then
                        Range(col & c).Offset(0, 4) = instrumentCapitalStructure(a).amtSellGov
                        Range(col & c).Offset(0, 5) = Range(col & c).Offset(0, 5) + instrumentCapitalStructure(a).amtSellGov
                    End If
                ElseIf e = 2 Then
                    If IsEmpty(instrumentCapitalStructure(a).amtBuyFin) = False Then
                        Range(col & c) = instrumentCapitalStructure(a).amtBuyFin
                        Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + instrumentCapitalStructure(a).amtBuyFin
                    End If
                    
                    If IsEmpty(instrumentCapitalStructure(a).amtSellFin) = False Then
                        Range(col & c).Offset(0, 4) = instrumentCapitalStructure(a).amtSellFin
                        Range(col & c).Offset(0, 5) = Range(col & c).Offset(0, 5) + instrumentCapitalStructure(a).amtSellFin
                    End If
                ElseIf e = 3 Then
                    If IsEmpty(instrumentCapitalStructure(a).amtBuyCorp) = False Then
                        Range(col & c) = instrumentCapitalStructure(a).amtBuyCorp
                        Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + instrumentCapitalStructure(a).amtBuyCorp
                    End If
                    
                    If IsEmpty(instrumentCapitalStructure(a).amtSellCorp) = False Then
                        Range(col & c).Offset(0, 4) = instrumentCapitalStructure(a).amtSellCorp
                        Range(col & c).Offset(0, 5) = Range(col & c).Offset(0, 5) + instrumentCapitalStructure(a).amtSellCorp
                    End If
                End If
            End If
        Next
        
        If trouve = False Then
            If e = 1 Then
                If IsEmpty(instrumentCapitalStructure(a).amtBuyGov) = False Then
                    Range(col & derniereLigne(e) + 1) = Range(col & derniereLigne(e) + 1) + instrumentCapitalStructure(a).amtBuyGov
                    Range(col & derniereLigne(e) + 1).Offset(0, 1) = Range(col & derniereLigne(e) + 1).Offset(0, 1) + instrumentCapitalStructure(a).amtBuyGov
                End If
                
                If IsEmpty(instrumentCapitalStructure(a).amtSellGov) = False Then
                    Range(col & derniereLigne(e) + 1).Offset(0, 4) = Range(col & derniereLigne(e) + 1).Offset(0, 4) + instrumentCapitalStructure(a).amtSellGov
                    Range(col & derniereLigne(e) + 1).Offset(0, 5) = Range(col & derniereLigne(e) + 1).Offset(0, 5) + instrumentCapitalStructure(a).amtSellGov
                End If
            ElseIf e = 2 Then
                If IsEmpty(instrumentCapitalStructure(a).amtBuyFin) = False Then
                    Range(col & derniereLigne(e) + 1) = Range(col & derniereLigne(e) + 1) + instrumentCapitalStructure(a).amtBuyFin
                    Range(col & derniereLigne(e) + 1).Offset(0, 1) = Range(col & derniereLigne(e) + 1).Offset(0, 1) + instrumentCapitalStructure(a).amtBuyFin
                End If
                
                If IsEmpty(instrumentCapitalStructure(a).amtSellFin) = False Then
                    Range(col & derniereLigne(e) + 1).Offset(0, 4) = Range(col & derniereLigne(e) + 1).Offset(0, 4) + instrumentCapitalStructure(a).amtSellFin
                    Range(col & derniereLigne(e) + 1).Offset(0, 5) = Range(col & derniereLigne(e) + 1).Offset(0, 5) + instrumentCapitalStructure(a).amtSellFin
                End If
            ElseIf e = 3 Then
                If IsEmpty(instrumentCapitalStructure(a).amtBuyCorp) = False Then
                    Range(col & derniereLigne(e) + 1) = Range(col & derniereLigne(e) + 1) + instrumentCapitalStructure(a).amtBuyCorp
                    Range(col & derniereLigne(e) + 1).Offset(0, 1) = Range(col & derniereLigne(e) + 1).Offset(0, 1) + instrumentCapitalStructure(a).amtBuyCorp
                End If
                
                If IsEmpty(instrumentCapitalStructure(a).amtSellCorp) = False Then
                    Range(col & derniereLigne(e) + 1).Offset(0, 4) = Range(col & derniereLigne(e) + 1).Offset(0, 4) + instrumentCapitalStructure(a).amtSellCorp
                    Range(col & derniereLigne(e) + 1).Offset(0, 5) = Range(col & derniereLigne(e) + 1).Offset(0, 5) + instrumentCapitalStructure(a).amtSellCorp
                End If
            End If
        End If
    Next
Next

End Sub

Sub afficherTradingVenues()

Dim a As Long, b As Long, c As Long
Dim d As Integer, e As Integer
Dim trouve As Boolean
Dim col As String, colBroker As String
Dim row(3) As Long
Dim derniereLigne(3) As Long
row(1) = 11
col = "BA"
colBroker = "AZ"

For a = 1 To 3
    If a > 1 Then
        row(a) = derniereLigne(a - 1) + 6
    End If
    
    derniereLigne(a) = calculLastRow(col, row(a))
Next

For a = 1 To UBound(venues)
    For e = 1 To 3
        trouve = False
        For c = row(e) To derniereLigne(e)
            If venues(a).tdVenue = Range(colBroker & c) Then
                trouve = True
                
                If e = 1 Then
                    If IsEmpty(venues(a).amtBuyGov) = False Then
                        Range(col & c) = venues(a).amtBuyGov
                        Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + venues(a).amtBuyGov
                    End If
                    
                    If IsEmpty(venues(a).amtSellGov) = False Then
                        Range(col & c).Offset(0, 4) = venues(a).amtSellGov
                        Range(col & c).Offset(0, 5) = Range(col & c).Offset(0, 5) + venues(a).amtSellGov
                    End If
                ElseIf e = 2 Then
                    If IsEmpty(venues(a).amtBuyFin) = False Then
                        Range(col & c) = venues(a).amtBuyFin
                        Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + venues(a).amtBuyFin
                    End If
                    
                    If IsEmpty(venues(a).amtSellFin) = False Then
                        Range(col & c).Offset(0, 4) = venues(a).amtSellFin
                        Range(col & c).Offset(0, 5) = Range(col & c).Offset(0, 5) + venues(a).amtSellFin
                    End If
                ElseIf e = 3 Then
                    If IsEmpty(venues(a).amtBuyCorp) = False Then
                        Range(col & c) = venues(a).amtBuyCorp
                        Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + venues(a).amtBuyCorp
                    End If
                    
                    If IsEmpty(venues(a).amtSellCorp) = False Then
                        Range(col & c).Offset(0, 4) = venues(a).amtSellCorp
                        Range(col & c).Offset(0, 5) = Range(col & c).Offset(0, 5) + venues(a).amtSellCorp
                    End If
                End If
            End If
        Next
        
        If trouve = False Then
            If e = 1 Then
                If IsEmpty(venues(a).amtBuyGov) = False Then
                    Range(col & derniereLigne(e) + 1) = Range(col & derniereLigne(e) + 1) + venues(a).amtBuyGov
                    Range(col & derniereLigne(e) + 1).Offset(0, 1) = Range(col & derniereLigne(e) + 1).Offset(0, 1) + venues(a).amtBuyGov
                End If
                
                If IsEmpty(venues(a).amtSellGov) = False Then
                    Range(col & derniereLigne(e) + 1).Offset(0, 4) = Range(col & derniereLigne(e) + 1).Offset(0, 4) + venues(a).amtSellGov
                    Range(col & derniereLigne(e) + 1).Offset(0, 5) = Range(col & derniereLigne(e) + 1).Offset(0, 5) + venues(a).amtSellGov
                End If
            ElseIf e = 2 Then
                If IsEmpty(venues(a).amtBuyFin) = False Then
                    Range(col & derniereLigne(e) + 1) = Range(col & derniereLigne(e) + 1) + venues(a).amtBuyFin
                    Range(col & derniereLigne(e) + 1).Offset(0, 1) = Range(col & derniereLigne(e) + 1).Offset(0, 1) + venues(a).amtBuyFin
                End If
                
                If IsEmpty(venues(a).amtSellFin) = False Then
                    Range(col & derniereLigne(e) + 1).Offset(0, 4) = Range(col & derniereLigne(e) + 1).Offset(0, 4) + venues(a).amtSellFin
                    Range(col & derniereLigne(e) + 1).Offset(0, 5) = Range(col & derniereLigne(e) + 1).Offset(0, 5) + venues(a).amtSellFin
                End If
            ElseIf e = 3 Then
                If IsEmpty(venues(a).amtBuyCorp) = False Then
                    Range(col & derniereLigne(e) + 1) = Range(col & derniereLigne(e) + 1) + venues(a).amtBuyCorp
                    Range(col & derniereLigne(e) + 1).Offset(0, 1) = Range(col & derniereLigne(e) + 1).Offset(0, 1) + venues(a).amtBuyCorp
                End If
                
                If IsEmpty(venues(a).amtSellCorp) = False Then
                    Range(col & derniereLigne(e) + 1).Offset(0, 4) = Range(col & derniereLigne(e) + 1).Offset(0, 4) + venues(a).amtSellCorp
                    Range(col & derniereLigne(e) + 1).Offset(0, 5) = Range(col & derniereLigne(e) + 1).Offset(0, 5) + venues(a).amtSellCorp
                End If
            End If
        End If
    Next
Next


End Sub

Sub afficherMaturityAndOutstandingAndNominal()

Dim a As Long, b As Long, c As Long
Dim d As Integer, e As Integer
Dim trouve As Boolean
Dim row(3) As Long
Dim col(3) As String
Dim derniereLigne(3) As Long
Dim tabVar As instrumentMaturityAndOutstandingAmtAndNominal
row(1) = 11

col(1) = "W"
col(2) = "AG"
col(3) = "AQ"

For a = 1 To 3
    If a > 1 Then
        row(a) = derniereLigne(a - 1) + 5
    End If
    
    derniereLigne(a) = calculLastRow(col(a), row(a)) + 1
Next

For d = 1 To 3
    If d = 1 Then
        tabVar = maturityAmt
        
        col(d) = "W"
    ElseIf d = 2 Then
        tabVar = outstandingAmt
        
        col(d) = "AG"
    ElseIf d = 3 Then
        tabVar = nominalAmt
        
        col(d) = "AQ"
    End If
    
    If IsEmpty(tabVar.buyGovMin) = False Then
        Range(col(d) & row(1)) = tabVar.buyGovMin
        Range(col(d) & row(1)).Offset(0, 1) = Range(col(d) & row(1)).Offset(0, 1) + tabVar.buyGovMin
    End If
    If IsEmpty(tabVar.sellGovMin) = False Then
        Range(col(d) & row(1)).Offset(0, 4) = tabVar.sellGovMin
        Range(col(d) & row(1)).Offset(0, 5) = Range(col(d) & row(1)).Offset(0, 5) + tabVar.sellGovMin
    End If
    
    If IsEmpty(tabVar.buyGovSup) = False Then
        Range(col(d) & derniereLigne(1)) = tabVar.buyGovSup
        Range(col(d) & derniereLigne(1)).Offset(0, 1) = Range(col(d) & derniereLigne(1)).Offset(0, 1) + tabVar.buyGovSup
    End If
    If IsEmpty(tabVar.sellGovSup) = False Then
        Range(col(d) & derniereLigne(1)).Offset(0, 4) = tabVar.sellGovSup
        Range(col(d) & derniereLigne(1)).Offset(0, 5) = Range(col(d) & derniereLigne(1)).Offset(0, 5) + tabVar.sellGovSup
    End If
    
    If IsEmpty(tabVar.buyFinMin) = False Then
        Range(col(d) & row(2)) = tabVar.buyFinMin
        Range(col(d) & row(2)).Offset(0, 1) = Range(col(d) & row(2)).Offset(0, 1) + tabVar.buyFinMin
    End If
    If IsEmpty(tabVar.sellFinMin) = False Then
        Range(col(d) & row(2)).Offset(0, 4) = tabVar.sellFinMin
        Range(col(d) & row(2)).Offset(0, 5) = Range(col(d) & row(2)).Offset(0, 5) + tabVar.sellFinMin
    End If
    
    
    If IsEmpty(tabVar.buyFinSup) = False Then
        Range(col(d) & derniereLigne(2)) = tabVar.buyFinSup
        Range(col(d) & derniereLigne(2)).Offset(0, 1) = Range(col(d) & derniereLigne(2)).Offset(0, 1) + tabVar.buyFinSup
    End If
    If IsEmpty(tabVar.sellFinSup) = False Then
        Range(col(d) & derniereLigne(2)).Offset(0, 4) = tabVar.sellFinSup
        Range(col(d) & derniereLigne(2)).Offset(0, 5) = Range(col(d) & derniereLigne(2)).Offset(0, 5) + tabVar.sellFinSup
    End If
    
    If IsEmpty(tabVar.buyCorpMin) = False Then
        Range(col(d) & row(3)) = tabVar.buyCorpMin
        Range(col(d) & row(3)).Offset(0, 1) = Range(col(d) & row(3)).Offset(0, 1) + tabVar.buyCorpMin
    End If
    If IsEmpty(tabVar.sellCorpMin) = False Then
        Range(col(d) & row(3)).Offset(0, 4) = tabVar.sellCorpMin
        Range(col(d) & row(3)).Offset(0, 5) = Range(col(d) & row(3)).Offset(0, 5) + tabVar.sellCorpMin
    End If
    
    If IsEmpty(tabVar.buyCorpSup) = False Then
        Range(col(d) & derniereLigne(3)) = tabVar.buyCorpSup
        Range(col(d) & derniereLigne(3)).Offset(0, 1) = Range(col(d) & derniereLigne(3)).Offset(0, 1) + tabVar.buyCorpSup
    End If
    If IsEmpty(tabVar.sellCorpSup) = False Then
        Range(col(d) & derniereLigne(3)).Offset(0, 4) = tabVar.sellCorpSup
        Range(col(d) & derniereLigne(3)).Offset(0, 5) = Range(col(d) & derniereLigne(3)).Offset(0, 5) + tabVar.sellCorpSup
    End If
Next

End Sub

Sub afficherInstrumentSegment()

Dim a As Long, b As Long, c As Long
Dim d As Integer, e As Integer
Dim row(3) As Long
Dim col As String, colBroker As String
Dim derniereLigne(3) As Long
Dim trouve As Boolean
row(1) = 11

col = "M"
colBroker = "L"

For a = 1 To 3
    If a > 1 Then
        row(a) = derniereLigne(a - 1) + 6
    End If
    
    derniereLigne(a) = calculLastRow(col, row(a))
Next

For a = 1 To UBound(segmentAmt)
    For e = 1 To 3
        trouve = False
        For c = row(e) To derniereLigne(e)
            If segmentAmt(a).segment = Range(colBroker & c) Then
                trouve = True
                
                If e = 1 Then
                    If IsEmpty(segmentAmt(a).amtBuyGov) = False Then
                        Range(col & c) = segmentAmt(a).amtBuyGov
                        Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + segmentAmt(a).amtBuyGov
                    End If
                    
                    If IsEmpty(segmentAmt(a).amtSellGov) = False Then
                        Range(col & c).Offset(0, 4) = segmentAmt(a).amtSellGov
                        Range(col & c).Offset(0, 5) = Range(col & c).Offset(0, 5) + segmentAmt(a).amtSellGov
                    End If
                ElseIf e = 2 Then
                    If IsEmpty(segmentAmt(a).amtBuyFin) = False Then
                        Range(col & c) = segmentAmt(a).amtBuyFin
                        Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + segmentAmt(a).amtBuyFin
                    End If
                    If IsEmpty(segmentAmt(a).amtSellFin) = False Then
                        Range(col & c).Offset(0, 4) = segmentAmt(a).amtSellFin
                        Range(col & c).Offset(0, 5) = Range(col & c).Offset(0, 5) + segmentAmt(a).amtSellFin
                    End If
                ElseIf e = 3 Then
                    If IsEmpty(segmentAmt(a).amtBuyCorp) = False Then
                        Range(col & c) = segmentAmt(a).amtBuyCorp
                        Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + segmentAmt(a).amtBuyCorp
                    End If
                    
                    If IsEmpty(segmentAmt(a).amtSellCorp) = False Then
                        Range(col & c).Offset(0, 4) = segmentAmt(a).amtSellCorp
                        Range(col & c).Offset(0, 5) = Range(col & c).Offset(0, 5) + segmentAmt(a).amtSellCorp
                    End If
                End If
            End If
        Next
        
        If trouve = False Then
            If e = 1 Then
                If IsEmpty(segmentAmt(a).amtBuyGov) = False Then
                    Range(col & derniereLigne(e) + 1) = Range(col & derniereLigne(e) + 1) + segmentAmt(a).amtBuyGov
                    Range(col & derniereLigne(e) + 1).Offset(0, 1) = Range(col & derniereLigne(e) + 1).Offset(0, 1) + segmentAmt(a).amtBuyGov
                End If
                
                If IsEmpty(segmentAmt(a).amtSellGov) = False Then
                    Range(col & derniereLigne(e) + 1).Offset(0, 4) = Range(col & derniereLigne(e) + 1).Offset(0, 4) + segmentAmt(a).amtSellGov
                    Range(col & derniereLigne(e) + 1).Offset(0, 5) = Range(col & derniereLigne(e) + 1).Offset(0, 5) + segmentAmt(a).amtSellGov
                End If
            ElseIf e = 2 Then
                If IsEmpty(segmentAmt(a).amtBuyFin) = False Then
                    Range(col & derniereLigne(e) + 1) = Range(col & derniereLigne(e) + 1) + segmentAmt(a).amtBuyFin
                    Range(col & derniereLigne(e) + 1).Offset(0, 1) = Range(col & derniereLigne(e) + 1).Offset(0, 1) + segmentAmt(a).amtBuyFin
                End If
                
                If IsEmpty(segmentAmt(a).amtSellFin) = False Then
                    Range(col & derniereLigne(e) + 1).Offset(0, 4) = Range(col & derniereLigne(e) + 1).Offset(0, 4) + segmentAmt(a).amtSellFin
                    Range(col & derniereLigne(e) + 1).Offset(0, 5) = Range(col & derniereLigne(e) + 1).Offset(0, 5) + segmentAmt(a).amtSellFin
                End If
            ElseIf e = 3 Then
                If IsEmpty(segmentAmt(a).amtBuyCorp) = False Then
                    Range(col & derniereLigne(e) + 1) = Range(col & derniereLigne(e) + 1) + segmentAmt(a).amtBuyCorp
                    Range(col & derniereLigne(e) + 1).Offset(0, 1) = Range(col & derniereLigne(e) + 1).Offset(0, 1) + segmentAmt(a).amtBuyCorp
                End If
                
                If IsEmpty(segmentAmt(a).amtSellCorp) = False Then
                    Range(col & derniereLigne(e) + 1).Offset(0, 4) = Range(col & derniereLigne(e) + 1).Offset(0, 4) + segmentAmt(a).amtSellCorp
                    Range(col & derniereLigne(e) + 1).Offset(0, 5) = Range(col & derniereLigne(e) + 1).Offset(0, 5) + segmentAmt(a).amtSellCorp
                End If
            End If
        End If
    Next
Next

End Sub

Sub countriesEMOnly()

Workbooks(wbTemplate).Worksheets(wsTemplate8).Activate

Dim a As Long, b As Long, c As Long
Dim d As Integer, e As Integer, f As Integer
Dim row(6) As Long
Dim col As String, colBroker As String, colPays As String
Dim derniereLigne(6) As Long
Dim trouve As Boolean
Dim tabVar() As instrumentEMOnly
row(1) = 12

col = "C"
colBroker = "B"

For a = 1 To 6
    If a > 1 Then
        row(a) = derniereLigne(a - 1) + 5
    End If
    
    If a < 5 Then
        colPays = "B"
    ElseIf a > 4 And a < 9 Then
        colPays = "R"
    ElseIf a > 8 Then
        colPays = "AH"
    End If
    
    If Range(colPays & row(a)).Offset(1, 0) <> "" Then
        derniereLigne(a) = calculLastRow(col, row(a)) + 1
    Else
        derniereLigne(a) = row(a)
    End If
Next

For f = 1 To 3

    If f = 1 Then
        col = "C"
        colBroker = "B"
        
        tabVar() = EMOnlyAmtHard()
    ElseIf f = 2 Then
        col = "S"
        colBroker = "R"
        
        tabVar() = EMOnlyAmtLocal()
    ElseIf f = 3 Then
        col = "AI"
        colBroker = "AH"
        
        tabVar() = EMOnlyAmt()
    End If

    For a = 1 To UBound(tabVar)
        trouve = False
        For e = 1 To 6
            For c = row(e) To derniereLigne(e)
                If tabVar(a).country = Range(colBroker & c) Then
                    trouve = True
                    
                    If IsEmpty(tabVar(a).amtBuyGov) = False Then
                        Range(col & c) = tabVar(a).amtBuyGov
                        Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + tabVar(a).amtBuyGov
                    End If
                    If IsEmpty(tabVar(a).amtSellGov) = False Then
                        Range(col & c).Offset(0, 3) = tabVar(a).amtSellGov
                        Range(col & c).Offset(0, 4) = Range(col & c).Offset(0, 4) + tabVar(a).amtSellGov
                    End If
                    If IsEmpty(tabVar(a).amtBuyCorp) = False Then
                        Range(col & c).Offset(0, 7) = tabVar(a).amtBuyCorp
                        Range(col & c).Offset(0, 8) = Range(col & c).Offset(0, 8) + tabVar(a).amtBuyCorp
                    End If
                    If IsEmpty(tabVar(a).amtSellCorp) = False Then
                        Range(col & c).Offset(0, 10) = tabVar(a).amtSellCorp
                        Range(col & c).Offset(0, 11) = Range(col & c).Offset(0, 11) + tabVar(a).amtSellCorp
                    End If
                End If
            Next
        Next
        
        If trouve = False Then
            If IsEmpty(tabVar(a).amtBuyGov) = False Then
                Range(col & derniereLigne(6) + 4) = tabVar(a).amtBuyGov
                Range(col & derniereLigne(6) + 4).Offset(0, 1) = Range(col & derniereLigne(6) + 4).Offset(0, 1) + tabVar(a).amtBuyGov
            End If
            If IsEmpty(tabVar(a).amtSellGov) = False Then
                Range(col & derniereLigne(6) + 4).Offset(0, 3) = tabVar(a).amtSellGov
                Range(col & derniereLigne(6) + 4).Offset(0, 4) = Range(col & derniereLigne(6) + 4).Offset(0, 4) + tabVar(a).amtSellGov
            End If
            If IsEmpty(tabVar(a).amtBuyCorp) = False Then
                Range(col & derniereLigne(6) + 4).Offset(0, 7) = tabVar(a).amtBuyCorp
                Range(col & derniereLigne(6) + 4).Offset(0, 8) = Range(col & derniereLigne(6) + 4).Offset(0, 8) + tabVar(a).amtBuyCorp
            End If
            If IsEmpty(tabVar(a).amtSellCorp) = False Then
                Range(col & derniereLigne(6) + 4).Offset(0, 10) = tabVar(a).amtSellCorp
                Range(col & derniereLigne(6) + 4).Offset(0, 11) = Range(col & derniereLigne(6) + 4).Offset(0, 11) + tabVar(a).amtSellCorp
            End If
        End If
    Next
Next

End Sub

Sub afficherInstrumentCountry()

Dim a As Long, b As Long, c As Long
Dim d As Integer, e As Integer
Dim row(3) As Long
Dim col As String, colBroker As String
Dim derniereLigne(3) As Long
Dim trouve As Boolean
row(1) = 11

col = "C"
colBroker = "B"

For a = 1 To 3
    If a > 1 Then
        row(a) = derniereLigne(a - 1) + 6
    End If
    
    derniereLigne(a) = calculLastRow(col, row(a))
Next

For a = 1 To UBound(countryAmt)
    For e = 1 To 3
        
        trouve = False
        For c = row(e) To derniereLigne(e)
            If countryAmt(a).country = Range(colBroker & c) Then
                trouve = True
                
                If e = 1 Then
                    If IsEmpty(countryAmt(a).amtBuyGov) = False Then
                        Range(col & c) = countryAmt(a).amtBuyGov
                        Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + countryAmt(a).amtBuyGov
                    End If
                    
                    If IsEmpty(countryAmt(a).amtSellGov) = False Then
                        Range(col & c).Offset(0, 4) = countryAmt(a).amtSellGov
                        Range(col & c).Offset(0, 5) = Range(col & c).Offset(0, 5) + countryAmt(a).amtSellGov
                    End If
                ElseIf e = 2 Then
                    If IsEmpty(countryAmt(a).amtBuyFin) = False Then
                        Range(col & c) = countryAmt(a).amtBuyFin
                        Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + countryAmt(a).amtBuyFin
                    End If
                    
                    If IsEmpty(countryAmt(a).amtSellFin) = False Then
                        Range(col & c).Offset(0, 4) = countryAmt(a).amtSellFin
                        Range(col & c).Offset(0, 5) = Range(col & c).Offset(0, 5) + countryAmt(a).amtSellFin
                    End If
                ElseIf e = 3 Then
                    If IsEmpty(countryAmt(a).amtBuyCorp) = False Then
                        Range(col & c) = countryAmt(a).amtBuyCorp
                        Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + countryAmt(a).amtBuyCorp
                    End If
                    
                    If IsEmpty(countryAmt(a).amtSellCorp) = False Then
                        Range(col & c).Offset(0, 4) = countryAmt(a).amtSellCorp
                        Range(col & c).Offset(0, 5) = Range(col & c).Offset(0, 5) + countryAmt(a).amtSellCorp
                    End If
                End If
            End If
        Next
        
        If trouve = False Then
            If e = 1 Then
                If IsEmpty(countryAmt(a).amtBuyGov) = False Then
                    Range(col & derniereLigne(e) + 1) = Range(col & derniereLigne(e) + 1) + countryAmt(a).amtBuyGov
                    Range(col & derniereLigne(e) + 1).Offset(0, 1) = Range(col & derniereLigne(e) + 1).Offset(0, 1) + countryAmt(a).amtBuyGov
                End If
                
                If IsEmpty(countryAmt(a).amtSellGov) = False Then
                    Range(col & derniereLigne(e) + 1).Offset(0, 4) = Range(col & derniereLigne(e) + 1).Offset(0, 4) + countryAmt(a).amtSellGov
                    Range(col & derniereLigne(e) + 1).Offset(0, 5) = Range(col & derniereLigne(e) + 1).Offset(0, 5) + countryAmt(a).amtSellGov
                End If
            ElseIf e = 2 Then
                If IsEmpty(countryAmt(a).amtBuyFin) = False Then
                    Range(col & derniereLigne(e) + 1) = Range(col & derniereLigne(e) + 1) + countryAmt(a).amtBuyFin
                    Range(col & derniereLigne(e) + 1).Offset(0, 1) = Range(col & derniereLigne(e) + 1).Offset(0, 1) + countryAmt(a).amtBuyFin
                End If
                
                If IsEmpty(countryAmt(a).amtSellFin) = False Then
                    Range(col & derniereLigne(e) + 1).Offset(0, 4) = Range(col & derniereLigne(e) + 1).Offset(0, 4) + countryAmt(a).amtSellFin
                    Range(col & derniereLigne(e) + 1).Offset(0, 5) = Range(col & derniereLigne(e) + 1).Offset(0, 5) + countryAmt(a).amtSellFin
                End If
            ElseIf e = 3 Then
                If IsEmpty(countryAmt(a).amtBuyCorp) = False Then
                    Range(col & derniereLigne(e) + 1) = Range(col & derniereLigne(e) + 1) + countryAmt(a).amtBuyCorp
                    Range(col & derniereLigne(e) + 1).Offset(0, 1) = Range(col & derniereLigne(e) + 1).Offset(0, 1) + countryAmt(a).amtBuyCorp
                End If
                
                If IsEmpty(countryAmt(a).amtSellCorp) = False Then
                    Range(col & derniereLigne(e) + 1).Offset(0, 4) = Range(col & derniereLigne(e) + 1).Offset(0, 4) + countryAmt(a).amtSellCorp
                    Range(col & derniereLigne(e) + 1).Offset(0, 5) = Range(col & derniereLigne(e) + 1).Offset(0, 5) + countryAmt(a).amtSellCorp
                End If
            End If
        End If
    Next
Next

End Sub

Sub brokerDealersEMOnly()

Workbooks(wbTemplate).Worksheets(wsTemplate7).Activate

Dim a As Long, b As Long, c As Long
Dim tabVar1() As secondaryMarket
Dim tabVar2() As totalBrokerDealers
Dim col As String, colBroker As String
Dim trouve As Boolean
Dim row As Long
Dim derniereLigne As Long
row = 11

For b = 1 To 18
    If b = 1 Then
        tabVar1() = tabSecondaryConsoEMGovHard()
        
        col = "C"
        colBroker = "B"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 2 Then
        tabVar1() = tabPrimaryConsoEMGovHard()
        
        col = "G"
        colBroker = "B"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 3 Then
        tabVar1() = tabSecondaryConsoEMGovLocal()
        
        col = "M"
        colBroker = "L"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 4 Then
        tabVar1() = tabPrimaryConsoEMGovLocal()
        
        col = "Q"
        colBroker = "L"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 5 Then
        tabVar1() = tabSecondaryConsoEMGov()
        
        col = "W"
        colBroker = "V"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 6 Then
        tabVar1() = tabPrimaryConsoEMGov()
        
        col = "AA"
        colBroker = "V"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 7 Then
        tabVar1() = tabSecondaryConsoEMCredHard()
        
        col = "AG"
        colBroker = "AF"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 8 Then
        tabVar1() = tabPrimaryConsoEMCredHard()
        
        col = "AK"
        colBroker = "AF"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 9 Then
        tabVar1() = tabSecondaryConsoEMCredLocal()
        
        col = "AQ"
        colBroker = "AP"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 10 Then
        tabVar1() = tabPrimaryConsoEMCredLocal()
        
        col = "AU"
        colBroker = "AP"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 11 Then
        tabVar1() = tabSecondaryConsoEMCred()
        
        col = "BA"
        colBroker = "AZ"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 12 Then
        tabVar1() = tabPrimaryConsoEMCred()
        
        col = "BE"
        colBroker = "AZ"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 13 Then
        tabVar2() = tabTotalBrokerDealersEMHard()
        
        col = "BK"
        colBroker = "BJ"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 14 Then
        tabVar2() = tabTotalBrokerDealersEMHard()
        
        col = "BP"
        colBroker = "BJ"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 15 Then
        tabVar2() = tabTotalBrokerDealersEMLocal()
        
        col = "BW"
        colBroker = "BV"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 16 Then
        tabVar2() = tabTotalBrokerDealersEMLocal()
        
        col = "CB"
        colBroker = "BV"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 17 Then
        tabVar2() = tabTotalBrokerDealersEM()
        
        col = "CI"
        colBroker = "CH"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 18 Then
        tabVar2() = tabTotalBrokerDealersEM()
        
        col = "CN"
        colBroker = "CH"
        derniereLigne = calculLastRow(col, row)
    End If
    
    If b < 13 Then
        For a = 1 To UBound(tabVar1)
            trouve = False
            For c = row To derniereLigne
                If tabVar1(a).broker = Range(colBroker & c) Then
                    trouve = True
                    
                    Range(col & c) = tabVar1(a).amtDone
                    Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + tabVar1(a).amtDone
                End If
            Next
            
            If trouve = False Then
                Range(col & derniereLigne + 1) = Range(col & derniereLigne + 1) + tabVar1(a).amtDone
                Range(col & derniereLigne + 1).Offset(0, 1) = Range(col & derniereLigne + 1).Offset(0, 1) + tabVar1(a).amtDone
            End If
        Next
    Else
        For a = 1 To UBound(tabVar2)
            trouve = False
            For c = row To derniereLigne
                If tabVar2(a).broker = Range(colBroker & c) Then
                    trouve = True
                    
                    If b = 13 Or b = 15 Or b = 17 Then
                        If IsEmpty(tabVar2(a).secondary) = False Then
                            Range(col & c) = tabVar2(a).secondary
                            Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + tabVar2(a).secondary
                        End If
                    ElseIf b = 14 Or b = 16 Or b = 18 Then
                        If IsEmpty(tabVar2(a).primary) = False Then
                            Range(col & c) = tabVar2(a).primary
                            Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + tabVar2(a).primary
                        End If
                    End If
                End If
            Next
            
            If trouve = False Then
                If b = 13 Or b = 15 Or b = 17 Then
                    If IsEmpty(tabVar2(a).secondary) = False Then
                        Range(col & derniereLigne + 1) = Range(col & derniereLigne + 1) + tabVar2(a).secondary
                        Range(col & derniereLigne + 1).Offset(0, 1) = Range(col & derniereLigne + 1).Offset(0, 1) + tabVar2(a).secondary
                    End If
                ElseIf b = 14 Or b = 16 Or b = 18 Then
                    If IsEmpty(tabVar2(a).primary) = False Then
                        Range(col & derniereLigne + 1) = Range(col & derniereLigne + 1) + tabVar2(a).primary
                        Range(col & derniereLigne + 1).Offset(0, 1) = Range(col & derniereLigne + 1).Offset(0, 1) + tabVar2(a).primary
                    End If
                End If
            End If
        Next
    End If
Next

Call tri("B", "H", 11, derniereLigne, "D", "H", wsTemplate7)
Call tri("L", "R", 11, derniereLigne, "N", "R", wsTemplate7)
Call tri("V", "AB", 11, derniereLigne, "X", "AB", wsTemplate7)
Call tri("AF", "AL", 11, derniereLigne, "AH", "AL", wsTemplate7)
Call tri("AP", "AV", 11, derniereLigne, "AR", "AV", wsTemplate7)
Call tri("AZ", "BF", 11, derniereLigne, "BB", "BF", wsTemplate7)
Call tri("BJ", "BR", 11, derniereLigne, "BL", "BQ", wsTemplate7)
Call tri("BV", "CD", 11, derniereLigne, "BX", "CC", wsTemplate7)
Call tri("CH", "CP", 11, derniereLigne, "CJ", "CO", wsTemplate7)

Range("A1").Select

End Sub

Sub brokerDealers()

Workbooks(wbTemplate).Worksheets(wsTemplate6).Activate

Dim a As Long, b As Long, c As Long
Dim tabVar1() As secondaryMarket
Dim tabVar2() As totalBrokerDealers
Dim col As String, colBroker As String
Dim trouve As Boolean
Dim row As Long
Dim derniereLigne As Long
row = 11

For b = 1 To 6
    If b = 1 Then
        tabVar1() = tabSecondaryConsoGov()
        
        col = "C"
        colBroker = "B"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 2 Then
        tabVar1() = tabPrimaryConsoGov()
        
        col = "G"
        colBroker = "B"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 3 Then
        tabVar1() = tabSecondaryConsoCred()
        
        col = "M"
        colBroker = "L"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 4 Then
        tabVar1() = tabPrimaryConsoCred()
        
        col = "Q"
        colBroker = "L"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 5 Then
        tabVar2() = tabTotalBrokerDealers()
        
        col = "W"
        colBroker = "V"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 6 Then
        tabVar2() = tabTotalBrokerDealers()
        
        col = "AB"
        colBroker = "V"
        derniereLigne = calculLastRow(col, row)
    End If
    
    If b < 5 Then
        For a = 1 To UBound(tabVar1)
            trouve = False
            For c = row To derniereLigne
                If tabVar1(a).broker = Range(colBroker & c) Then
                    trouve = True
                    
                    Range(col & c) = tabVar1(a).amtDone
                    Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + tabVar1(a).amtDone
                End If
            Next
            
            If trouve = False Then
                Range(col & derniereLigne + 1) = Range(col & derniereLigne + 1) + tabVar1(a).amtDone
                Range(col & derniereLigne + 1).Offset(0, 1) = Range(col & derniereLigne + 1).Offset(0, 1) + tabVar1(a).amtDone
            End If
        Next
    Else
        For a = 1 To UBound(tabVar2)
            trouve = False
            For c = row To derniereLigne
                If tabVar2(a).broker = Range(colBroker & c) Then
                    trouve = True
                    
                    If b = 5 Then
                        If IsEmpty(tabVar2(a).secondary) = False Then
                            Range(col & c) = tabVar2(a).secondary
                            Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + tabVar2(a).secondary
                        End If
                    ElseIf b = 6 Then
                        If IsEmpty(tabVar2(a).primary) = False Then
                            Range(col & c) = tabVar2(a).primary
                            Range(col & c).Offset(0, 1) = Range(col & c).Offset(0, 1) + tabVar2(a).primary
                        End If
                    End If
                End If
            Next
            
            If trouve = False Then
                If b = 5 Then
                    If IsEmpty(tabVar2(a).secondary) = False Then
                        Range(col & derniereLigne + 1) = Range(col & derniereLigne + 1) + tabVar2(a).secondary
                        Range(col & derniereLigne + 1).Offset(0, 1) = Range(col & derniereLigne + 1).Offset(0, 1) + tabVar2(a).secondary
                    End If
                ElseIf b = 6 Then
                    If IsEmpty(tabVar2(a).primary) = False Then
                        Range(col & derniereLigne + 1) = Range(col & derniereLigne + 1) + tabVar2(a).primary
                        Range(col & derniereLigne + 1).Offset(0, 1) = Range(col & derniereLigne + 1).Offset(0, 1) + tabVar2(a).primary
                    End If
                End If
            End If
        Next
    End If
Next

Call tri("B", "H", 11, derniereLigne, "D", "H", wsTemplate6)
Call tri("L", "R", 11, derniereLigne, "N", "R", wsTemplate6)
Call tri("V", "AD", 11, derniereLigne, "X", "AC", wsTemplate6)

Range("A1").Select

End Sub

Sub primaryMarketTradeData()

Workbooks(wbTemplate).Worksheets(wsTemplate4).Activate

Dim a As Long, b As Long, c As Long
Dim tabVar() As secondaryMarket
Dim col As String, colBroker As String, colFin As String
Dim trouve As Boolean
Dim row As Long
Dim derniereLigne As Long
row = 11

For b = 1 To 16
    If b = 1 Then
        tabVar() = tabPrimaryDMGovFunds()
        
        col = "D"
        colBroker = "B"
        colFin = "I"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 2 Then
        tabVar() = tabPrimaryDMCredFunds()
        
        col = "O"
        colFin = "T"
        colBroker = "M"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 3 Then
        tabVar() = tabPrimaryEMGovHardFunds()
        
        col = "Y"
        colFin = "AD"
        colBroker = "X"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 4 Then
        tabVar() = tabPrimaryEMGovLocalFunds()
        
        col = "AI"
        colFin = "AN"
        colBroker = "AH"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 5 Then
        tabVar() = tabPrimaryEMGovFunds()
        
        col = "AS"
        colFin = "AX"
        colBroker = "AR"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 6 Then
        tabVar() = tabPrimaryEMCredHardFunds()
        
        col = "BC"
        colFin = "BH"
        colBroker = "BB"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 7 Then
        tabVar() = tabPrimaryEMCredLocalFunds()
        
        col = "BM"
        colFin = "BR"
        colBroker = "BL"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 8 Then
        tabVar() = tabPrimaryEMCredFunds()
        
        col = "BW"
        colFin = "CB"
        colBroker = "BV"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 9 Then
        tabVar() = tabPrimaryDMGovMandates()
        
        col = "CH"
        colFin = "CM"
        colBroker = "CF"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 10 Then
        tabVar() = tabPrimaryDMCredMandates()
        
        col = "CS"
        colFin = "CX"
        colBroker = "CQ"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 11 Then
        tabVar() = tabPrimaryEMGovHardMandates()
        
        col = "DC"
        colFin = "DH"
        colBroker = "DB"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 12 Then
        tabVar() = tabPrimaryEMGovLocalMandates()
        
        col = "DM"
        colFin = "DR"
        colBroker = "DL"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 13 Then
        tabVar() = tabPrimaryEMGovMandates()
        
        col = "DW"
        colFin = "EB"
        colBroker = "DV"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 14 Then
        tabVar() = tabPrimaryEMCredHardMandates()
        
        col = "EG"
        colFin = "EL"
        colBroker = "EF"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 15 Then
        tabVar() = tabPrimaryEMCredLocalMandates()
        
        col = "EQ"
        colFin = "EV"
        colBroker = "EP"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 16 Then
        tabVar() = tabPrimaryEMCredMandates()
        
        col = "FA"
        colFin = "FF"
        colBroker = "EZ"
        derniereLigne = calculLastRow(col, row)
    End If
    
    For a = 1 To UBound(tabVar)
        trouve = False
        For c = row To derniereLigne
            If tabVar(a).broker = Range(colBroker & c) Then
                trouve = True
                
                If b <> 3 And b <> 4 And b <> 5 And b <> 6 And b <> 7 And b <> 8 And b <> 11 And b <> 12 And b <> 13 And b <> 14 And b <> 15 And b <> 16 Then
                    Range(col & c).Offset(0, -1) = tabVar(a).tiering
                End If
                Range(col & c) = Range(col & c) + tabVar(a).amtDone
                Range(col & c).Offset(0, 5) = Range(col & c).Offset(0, 5) + tabVar(a).dealDone
            End If
        Next
        
        If trouve = False Then
            Range(col & derniereLigne + 1) = Range(col & derniereLigne + 1) + tabVar(a).amtDone
            Range(col & derniereLigne + 1).Offset(0, 5) = Range(col & derniereLigne + 1).Offset(0, 5) + tabVar(a).dealDone
        End If
    Next
    
    Call tri(colBroker, colFin, row, derniereLigne, col, "", wsTemplate4)
Next

Range("A1").Select

End Sub

Sub primaryMarketTradeDataConso()

Workbooks(wbTemplate).Worksheets(wsTemplate5).Activate

Dim a As Long, b As Long, c As Long
Dim tabVar() As secondaryMarket
Dim col As String, colBroker As String, colFin As String
Dim trouve As Boolean
Dim row As Long
Dim derniereLigne As Long
row = 11

For b = 1 To 10
    If b = 1 Then
        tabVar() = tabPrimaryConsoDMGov()
        
        col = "D"
        colFin = "I"
        colBroker = "B"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 2 Then
        tabVar() = tabPrimaryConsoDMCred()
        
        col = "O"
        colFin = "T"
        colBroker = "M"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 3 Then
        tabVar() = tabPrimaryConsoEMGovHard()
        
        col = "Y"
        colFin = "AD"
        colBroker = "X"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 4 Then
        tabVar() = tabPrimaryConsoEMGovLocal()
        
        col = "AI"
        colFin = "AN"
        colBroker = "AH"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 5 Then
        tabVar() = tabPrimaryConsoEMGov()
        
        col = "AS"
        colFin = "AX"
        colBroker = "AR"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 6 Then
        tabVar() = tabPrimaryConsoEMCredHard()
        
        col = "BC"
        colFin = "BH"
        colBroker = "BB"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 7 Then
        tabVar() = tabPrimaryConsoEMCredLocal()
        
        col = "BM"
        colFin = "BR"
        colBroker = "BL"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 8 Then
        tabVar() = tabPrimaryConsoEMCred()
        
        col = "BW"
        colFin = "CB"
        colBroker = "BV"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 9 Then
        tabVar() = tabPrimaryConsoGov()
        
        col = "CG"
        colFin = "CL"
        colBroker = "CF"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 10 Then
        tabVar() = tabPrimaryConsoCred()
        
        col = "CQ"
        colFin = "CV"
        colBroker = "CP"
        derniereLigne = calculLastRow(col, row)
    End If
    
    For a = 1 To UBound(tabVar)
        trouve = False
        For c = row To derniereLigne
            If tabVar(a).broker = Range(colBroker & c) Then
                trouve = True
                
                If b < 3 Then
                    Range(col & c).Offset(0, -1) = tabVar(a).tiering
                End If
                Range(col & c) = Range(col & c) + tabVar(a).amtDone
                Range(col & c).Offset(0, 5) = Range(col & c).Offset(0, 5) + tabVar(a).dealDone
            End If
        Next
        
        If trouve = False Then
            Range(col & derniereLigne + 1) = Range(col & derniereLigne + 1) + tabVar(a).amtDone
            Range(col & derniereLigne + 1).Offset(0, 5) = Range(col & derniereLigne + 1).Offset(0, 5) + tabVar(a).dealDone
        End If
    Next
    
    Call tri(colBroker, colFin, row, derniereLigne, col, "", wsTemplate5)
    
Next

Range("A1").Select

End Sub

Sub secondaryMarketTradeData()

Workbooks(wbTemplate).Worksheets(wsTemplate2).Activate

Dim a As Long, b As Long, c As Long
Dim tabVar() As secondaryMarket
Dim col As String, colBroker As String, colFin As String, col2 As String
Dim trouve As Boolean
Dim row As Long
Dim derniereLigne As Long
row = 11


For b = 1 To 16
    If b = 1 Then
        tabVar() = tabSecondaryDMGovFunds()
        
        col = "D"
        colFin = "N"
        col2 = "G"
        colBroker = "B"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 2 Then
        tabVar() = tabSecondaryDMCredFunds()
        
        col = "T"
        colFin = "AD"
        col2 = "W"
        colBroker = "R"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 3 Then
        tabVar() = tabSecondaryEMGovHardFunds()
        
        col = "AI"
        colFin = "AS"
        col2 = "AL"
        colBroker = "AH"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 4 Then
        tabVar() = tabSecondaryEMGovLocalFunds()
        
        col = "AX"
        colFin = "BH"
        col2 = "BA"
        colBroker = "AW"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 5 Then
        tabVar() = tabSecondaryEMGovFunds()
        
        col = "BM"
        colFin = "BW"
        col2 = "BP"
        colBroker = "BL"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 6 Then
        tabVar() = tabSecondaryEMCredHardFunds()
        
        col = "CB"
        colFin = "CL"
        col2 = "CE"
        colBroker = "CA"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 7 Then
        tabVar() = tabSecondaryEMCredLocalFunds()
        
        col = "CQ"
        colFin = "DA"
        col2 = "CT"
        colBroker = "CP"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 8 Then
        tabVar() = tabSecondaryEMCredFunds()
        
        col = "DF"
        colFin = "DP"
        col2 = "DI"
        colBroker = "DE"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 9 Then
        tabVar() = tabSecondaryDMGovMandates()
        
        col = "DV"
        colFin = "EF"
        col2 = "DY"
        colBroker = "DT"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 10 Then
        tabVar() = tabSecondaryDMCredMandates()
        
        col = "EL"
        colFin = "EV"
        col2 = "EO"
        colBroker = "EJ"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 11 Then
        tabVar() = tabSecondaryEMGovHardMandates()
        
        col = "FA"
        colFin = "FK"
        col2 = "FD"
        colBroker = "EZ"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 12 Then
        tabVar() = tabSecondaryEMGovLocalMandates()
        
        col = "FP"
        colFin = "FZ"
        col2 = "FS"
        colBroker = "FO"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 13 Then
        tabVar() = tabSecondaryEMGovMandates()
        
        col = "GE"
        colFin = "GO"
        col2 = "GH"
        colBroker = "GD"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 14 Then
        tabVar() = tabSecondaryEMCredHardMandates()
        
        col = "GT"
        colFin = "HD"
        col2 = "GW"
        colBroker = "GS"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 15 Then
        tabVar() = tabSecondaryEMCredLocalMandates()
        
        col = "HI"
        colFin = "HS"
        col2 = "HL"
        colBroker = "HH"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 16 Then
        tabVar() = tabSecondaryEMCredMandates()
        
        col = "HX"
        colFin = "IH"
        col2 = "IA"
        colBroker = "HW"
        derniereLigne = calculLastRow(col, row)
    End If
    
    For a = 1 To UBound(tabVar)
        trouve = False
        For c = row To derniereLigne
            If tabVar(a).broker = Range(colBroker & c) Then
                trouve = True
                
                If b <> 3 And b <> 4 And b <> 5 And b <> 6 And b <> 7 And b <> 8 And b <> 11 And b <> 12 And b <> 13 And b <> 14 And b <> 15 And b <> 16 Then
                    Range(col & c).Offset(0, -1) = tabVar(a).tiering
                End If
                Range(col & c) = Range(col & c) + tabVar(a).amtDone
                Range(col & c).Offset(0, 3) = Range(col & c).Offset(0, 3) + tabVar(a).amtReq
                Range(col & c).Offset(0, 8) = Range(col & c).Offset(0, 8) + tabVar(a).dealDone
                Range(col & c).Offset(0, 9) = Range(col & c).Offset(0, 9) + tabVar(a).dealReq
            End If
        Next
        
        If trouve = False Then
            Range(col & derniereLigne + 1) = Range(col & derniereLigne + 1) + tabVar(a).amtDone
            Range(col & derniereLigne + 1).Offset(0, 3) = Range(col & derniereLigne + 1).Offset(0, 3) + tabVar(a).amtReq
            Range(col & derniereLigne + 1).Offset(0, 8) = Range(col & derniereLigne + 1).Offset(0, 8) + tabVar(a).dealDone
            Range(col & derniereLigne + 1).Offset(0, 9) = Range(col & derniereLigne + 1).Offset(0, 9) + tabVar(a).dealReq
        End If
    Next
    
    Call tri(colBroker, colFin, row, derniereLigne, col, col2, wsTemplate2)
    
Next

Range("A1").Select

End Sub

Sub secondaryMarketTradeDataConso()

Workbooks(wbTemplate).Worksheets(wsTemplate3).Activate

Dim a As Long, b As Long, c As Long
Dim tabVar() As secondaryMarket
Dim col As String, colBroker As String, colFin As String, col2 As String
Dim trouve As Boolean
Dim row As Long
Dim derniereLigne As Long
row = 11

For b = 1 To 10
    If b = 1 Then
        tabVar() = tabSecondaryConsoDMGov()
        
        col = "D"
        colFin = "N"
        col2 = "G"
        colBroker = "B"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 2 Then
        tabVar() = tabSecondaryConsoDMCred()
        
        col = "T"
        colFin = "AD"
        col2 = "W"
        colBroker = "R"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 3 Then
        tabVar() = tabSecondaryConsoEMGovHard()
        
        col = "AI"
        colFin = "AS"
        col2 = "AL"
        colBroker = "AH"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 4 Then
        tabVar() = tabSecondaryConsoEMGovLocal()
        
        col = "AX"
        colFin = "BH"
        col2 = "BA"
        colBroker = "AW"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 5 Then
        tabVar() = tabSecondaryConsoEMGov()
        
        col = "BM"
        colFin = "BW"
        col2 = "BP"
        colBroker = "BL"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 6 Then
        tabVar() = tabSecondaryConsoEMCredHard()
        
        col = "CB"
        colFin = "CL"
        col2 = "CE"
        colBroker = "CA"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 7 Then
        tabVar() = tabSecondaryConsoEMCredLocal()
        
        col = "CQ"
        colFin = "DA"
        col2 = "CT"
        colBroker = "CP"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 8 Then
        tabVar() = tabSecondaryConsoEMCred()
        
        col = "DF"
        colFin = "DP"
        col2 = "DI"
        colBroker = "DE"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 9 Then
        tabVar() = tabSecondaryConsoGov()
        
        col = "DV"
        colFin = "EF"
        col2 = "DY"
        colBroker = "DT"
        derniereLigne = calculLastRow(col, row)
    ElseIf b = 10 Then
        tabVar() = tabSecondaryConsoCred()
        
        col = "EL"
        colFin = "EV"
        col2 = "EO"
        colBroker = "EJ"
        derniereLigne = calculLastRow(col, row)
    End If
    
    For a = 1 To UBound(tabVar)
        trouve = False
        For c = row To derniereLigne
            If tabVar(a).broker = Range(colBroker & c) Then
                trouve = True
                
                If b <> 3 And b <> 4 And b <> 5 And b <> 6 And b <> 7 And b <> 8 Then
                    Range(col & c).Offset(0, -1) = tabVar(a).tiering
                End If
                Range(col & c) = Range(col & c) + tabVar(a).amtDone
                Range(col & c).Offset(0, 3) = Range(col & c).Offset(0, 3) + tabVar(a).amtReq
                Range(col & c).Offset(0, 8) = Range(col & c).Offset(0, 8) + tabVar(a).dealDone
                Range(col & c).Offset(0, 9) = Range(col & c).Offset(0, 9) + tabVar(a).dealReq
            End If
        Next
        
        If trouve = False Then
            Range(col & derniereLigne + 1) = Range(col & derniereLigne + 1) + tabVar(a).amtDone
            Range(col & derniereLigne + 1).Offset(0, 3) = Range(col & derniereLigne + 1).Offset(0, 3) + tabVar(a).amtReq
            Range(col & derniereLigne + 1).Offset(0, 8) = Range(col & derniereLigne + 1).Offset(0, 8) + tabVar(a).dealDone
            Range(col & derniereLigne + 1).Offset(0, 9) = Range(col & derniereLigne + 1).Offset(0, 9) + tabVar(a).dealReq
        End If
    Next
    
    Call tri(colBroker, colFin, row, derniereLigne, col, col2, wsTemplate3)
    
Next

Range("A1").Select

End Sub

Sub tabNominal()

Dim a As Long, b As Long
Dim sommeAmt As Variant
Dim sommeDD As Variant
Dim tabVar1() As secondaryMarket
Dim tabVar2() As secondaryMarket
Dim tabVar3() As secondaryMarket
Dim tabVar4() As secondaryMarket
Dim col As String
Dim row As Long

For b = 1 To 12
    sommeAmt = 0
    sommeDD = 0
    
    If b = 1 Then
        tabVar1() = tabSecondaryDMGovFunds()
        tabVar2() = tabSecondaryDMCredFunds()
        tabVar3() = tabSecondaryEMGovFunds()
        tabVar4() = tabSecondaryEMCredFunds()
        
        col = "C"
        row = 10
    ElseIf b = 2 Then
        tabVar1() = tabPrimaryDMGovFunds()
        tabVar2() = tabPrimaryDMCredFunds()
        tabVar3() = tabPrimaryEMGovFunds()
        tabVar4() = tabPrimaryEMCredFunds()
        
        col = "J"
        row = 10
    ElseIf b = 3 Then
        tabVar1() = tabSecondaryDMGovMandates()
        tabVar2() = tabSecondaryDMCredMandates()
        tabVar3() = tabSecondaryEMGovMandates()
        tabVar4() = tabSecondaryEMCredMandates()
        
        col = "C"
        row = 11
    ElseIf b = 4 Then
        tabVar1() = tabPrimaryDMGovMandates()
        tabVar2() = tabPrimaryDMCredMandates()
        tabVar3() = tabPrimaryEMGovMandates()
        tabVar4() = tabPrimaryEMCredMandates()
        
        col = "J"
        row = 11
    ElseIf b = 5 Then
        tabVar1() = tabSecondaryConsoDMGov()
        
        col = "C"
        row = 15
    ElseIf b = 6 Then
        tabVar1() = tabPrimaryConsoDMGov()
        
        col = "J"
        row = 15
    ElseIf b = 7 Then
        tabVar1() = tabSecondaryConsoEMGov()
        
        col = "C"
        row = 16
    ElseIf b = 8 Then
        tabVar1() = tabPrimaryConsoEMGov()
        
        col = "J"
        row = 16
    ElseIf b = 9 Then
        tabVar1() = tabSecondaryConsoDMCred()
        
        col = "C"
        row = 19
    ElseIf b = 10 Then
        tabVar1() = tabPrimaryConsoDMCred()
        
        col = "J"
        row = 19
    ElseIf b = 11 Then
        tabVar1() = tabSecondaryConsoEMCred()
        
        col = "C"
        row = 20
    ElseIf b = 12 Then
        tabVar1() = tabPrimaryConsoEMCred()
        
        col = "J"
        row = 20
    End If
    
    For a = 1 To UBound(tabVar1)
        sommeAmt = sommeAmt + tabVar1(a).amtDone
        sommeDD = sommeDD + tabVar1(a).dealDone
    Next
    
    If b < 5 Then
        For a = 1 To UBound(tabVar2)
            sommeAmt = sommeAmt + tabVar2(a).amtDone
            sommeDD = sommeDD + tabVar2(a).dealDone
        Next
    
        For a = 1 To UBound(tabVar3)
            sommeAmt = sommeAmt + tabVar3(a).amtDone
            sommeDD = sommeDD + tabVar3(a).dealDone
        Next
        
        For a = 1 To UBound(tabVar4)
            sommeAmt = sommeAmt + tabVar4(a).amtDone
            sommeDD = sommeDD + tabVar4(a).dealDone
        Next
    End If
    
    Range(col & row) = sommeAmt
    Range(col & row).Offset(0, 1) = sommeDD
    Range(col & row).Offset(0, 2) = Range(col & row).Offset(0, 2) + sommeAmt
    Range(col & row).Offset(0, 4) = Range(col & row).Offset(0, 4) + sommeDD
    
Next

End Sub

Sub tabMonthly()

Dim a As Long, b As Long
Dim row As Long
Dim col As String
Dim somme As Variant, deals As Long
Dim tabVar1() As secondaryMarket

row = moisNumero + 30
col = "C"

deals = 0
somme = 0
For b = 1 To 4
    If b = 1 Then
        tabVar1 = tabSecondaryConsoGov()
    ElseIf b = 2 Then
        tabVar1 = tabSecondaryConsoCred()
    ElseIf b = 3 Then
        tabVar1 = tabPrimaryConsoGov()
    ElseIf b = 4 Then
        tabVar1 = tabPrimaryConsoCred()
    End If
    
    For a = 1 To UBound(tabVar1)
        somme = somme + tabVar1(a).amtDone
        deals = deals + tabVar1(a).dealDone
    Next
Next

Range(col & row) = Range(col & row) + somme
Range(col & row).Offset(0, 1) = Range(col & row).Offset(0, 1) + deals

End Sub

Sub affichDate()

Dim col As String
Dim row As Long

col = "C"
row = 2

Range(col & row) = dateJour

End Sub

Function calculLastRow(col As String, row As Long)

Dim ligne As Long

ligne = Range(col & row).End(xlDown).row - 1

calculLastRow = ligne

End Function

Sub tri(colDeb, colFin, rowDeb, rowFin, colTri1, colTri2, feuille)

Range(colDeb & rowDeb & ":" & colFin & rowFin).Select

ActiveWorkbook.Worksheets(feuille).Sort.SortFields.Clear

ActiveWorkbook.Worksheets(feuille).Sort.SortFields.Add Key:=Range( _
    colTri1 & rowDeb & ":" & colTri1 & rowFin), SortOn:=xlSortOnValues, order:=xlDescending, DataOption:= _
    xlSortNormal
If colTri2 <> "" Then
    ActiveWorkbook.Worksheets(feuille).Sort.SortFields.Add Key:=Range( _
        colTri2 & rowDeb & ":" & colTri2 & rowFin), SortOn:=xlSortOnValues, order:=xlDescending, DataOption:= _
        xlSortNormal
End If
With ActiveWorkbook.Worksheets(feuille).Sort
    .SetRange Range(colDeb & rowDeb & ":" & colFin & rowFin)
    .Header = xlGuess
    .MatchCase = False
    .Orientation = xlTopToBottom
    .SortMethod = xlPinYin
    .Apply
End With

End Sub
